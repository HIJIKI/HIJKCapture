//--------------------------------------------------------------------------------------------------
//= EditCalc.hsp
//--------------------------------------------------------------------------------------------------
//	編集ウィンドウの計算処理
//--------------------------------------------------------------------------------------------------

	//----------------------------------------------------------------------------------------------
	//= キー入力の受付
	//----------------------------------------------------------------------------------------------
		CheckKeyInput 1

	//----------------------------------------------------------------------------------------------
	//= ボタン計算処理
	//----------------------------------------------------------------------------------------------
		mgButtonCalc

	//----------------------------------------------------------------------------------------------
	//= 終了処理(debug用)
	//----------------------------------------------------------------------------------------------
		if( GetKeyInput(KB_ESC) != 0 ){ goto *__end }

	//----------------------------------------------------------------------------------------------
	//= スクロール処理
	//----------------------------------------------------------------------------------------------
		if( GetKeyInput(MO_CENTER) != 0 ){
			x = MousePosX()-OldMousePosX
			y = MousePosY()-OldMousePosY
			EditPosX += x
			EditPosY += y
			EditPosX = limit(EditPosX, 0-CaptureSizeW, EDITWINDOW_SIZE_W)
			EditPosY = limit(EditPosY, 0-CaptureSizeH, EDITWINDOW_SIZE_H)
		}

	//----------------------------------------------------------------------------------------------
	//= ペンサイズ変更
	//----------------------------------------------------------------------------------------------
		MouseWheel = mousew
		if( MouseWheel != 0 ){
			EditPenSize += MouseWheel/120
			if( EditPenSize < 1 ){ EditPenSize = 1 }
		}

	//----------------------------------------------------------------------------------------------
	//= ペン / 消しゴム
	//----------------------------------------------------------------------------------------------
		x = MousePosX()-EditPosX
		y = MousePosY()-EditPosY
		oldx = OldMousePosX-EditPosX
		oldy = OldMousePosY-EditPosY
		//ペン
		if( GetKeyInput(MO_LEFT) != 0 ){
			gsel SCR_PENBUF
			ColorRef EditPenColor
			hjkLine x, y, oldx, oldy, EditPenSize
			gsel SCR_EDIT
		}
		//消しゴム
		if( GetKeyInput(MO_RIGHT) != 0 ){
			gsel SCR_PENBUF
			COLSET_ALPHA
			hjkLine x, y, oldx, oldy, EditPenSize*2
			gsel SCR_EDIT
		}

	//----------------------------------------------------------------------------------------------
	//= 1フレーム前のマウス座標
	//----------------------------------------------------------------------------------------------
		OldMousePosX = MousePosX()
		OldMousePosY = MousePosY()